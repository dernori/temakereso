<!DOCTYPE html>
<html lang="hu">
<head th:replace="fragments/head :: head('témakereső - ELTE IK')"></head>

<body>
	
	<p hidden="" id="topic" th:text="${id}"></p>
	<span hidden="" id="account" sec:authorize="isAuthenticated()" sec:authentication="principal.id"></span>

	<header th:replace="fragments/header :: header"></header>

	<main id="view-topic" class="container" role="main" style="display: none;">
	
		<section v-if="topic">
			<div class="row" id="headline">
				<div class="col-md-8">
		           	<h1>{{topic.name}}</h1>
		        </div>
		        <div class="col-md-4 text-right" >
                	<input type="button" class="btn btn-primary simple-button" v-on:click="editTopic" sec:authorize="isAuthenticated() &amp;&amp; hasRole('ROLE_SUPERVISOR')" v-if="topic.supervisor.account.id == getAccountId()" value="szerkesztés"/>
                	<input type="button" class="btn btn-primary simple-button" v-if="topic.type.id == 'BSC_THESIS' || topic.type.id == 'MSC_THESIS'" v-on:click="fillFormFromTopic" value="témabejelentő generálása"/>
		        </div>
			</div>
			
			<div class="row">
            	<div class="col-md-3"><h4>alapadatok</h4></div>
            </div>
			<div class="row">
                <label class="control-label col-md-3 text-right">típus</label>
                <div class="col-md-3">{{topic.type.name}}</div>
            </div>
             <div class="row">
                <label class="control-label col-md-3 text-right">kategória</label>
                <div class="col-md-9">{{topic.category.name}}</div>
            </div>
            <div class="row">
                <label class="control-label col-md-3 text-right">állapot</label>
                <div class="col-md-9">{{topic.status.name}}</div>
            </div>
            <div class="row">
                <label class="control-label col-md-3 text-right">archív</label>
                <div class="col-md-9">{{formatBoolean(topic.archive)}}</div>
            </div>
            <div class="row">
                <label class="control-label col-md-3 text-right">létrehozás dátuma</label>
                <div class="col-md-3">{{formatDate(topic.creationDate, 'YYYY. MM. DD.')}}</div>
            </div>
            
            <div class="row">
            	<div class="col-md-3"><h4>témavezető</h4></div>
            </div>
			<div class="row">
                <label class="control-label col-md-3 text-right">név</label>
                <div class="col-md-3">{{topic.supervisor.name}}</div>
            </div>
            <div class="row">
                <label class="control-label col-md-3 text-right">beosztás</label>
                <div class="col-md-9">{{topic.supervisor.title}}</div>
            </div>
            <div class="row">
                <label class="control-label col-md-3 text-right">munkahely</label>
                <div class="col-md-9">{{topic.supervisor.workplace}}</div>
            </div>
            <div class="row">
                <label class="control-label col-md-3 text-right">telefonszám</label>
                <div class="col-md-9">{{topic.supervisor.phone}}</div>
            </div>  
            <div class="row">
                <label class="control-label col-md-3 text-right">honlap</label>
                <div class="col-md-9">{{topic.supervisor.website}}</div>
            </div>
            <div class="row">
                <label class="control-label col-md-3 text-right">szoba</label>
                <div class="col-md-9">{{topic.supervisor.room}}</div>
            </div>  
            <div class="row">
                <label class="control-label col-md-3 text-right">fogadóórák</label>
                <div class="col-md-9">{{topic.supervisor.officeHours}}</div>
            </div>            
            <div class="row">
                <label class="control-label col-md-3 text-right">külsős</label>
                <div class="col-md-9">{{formatBoolean(topic.supervisor.external)}}</div>
            </div>
            <div class="row">
                <label class="control-label col-md-3 text-right">hitelesítve</label>
                <div class="col-md-9">{{formatBoolean(topic.supervisor.confirmed)}}</div>
            </div>
       
        	<div class="row">
            	<div class="col-md-3"><h4>részletes leírás</h4></div>
            </div>
        	<div class="row">
            	<div class="col-md-12">{{topic.description}}</div>
            </div>
            
            <div v-if="topic.attachments.length > 0">
	   			<div class="row">
	            	<div class="col-md-3"><h4>mellékletek</h4></div>
	            </div>
	            <div class="row" v-for="(attachment, index) in topic.attachments">
	                <label class="col-md-3 control-label"></label>
	                <div class="controls col-md-9">
	                    <a v-bind:href="getFileLink(attachment)">{{attachment.name}}</a>
	                </div>
	            </div>
            </div>
		</section>
		
		<!-- 
    private Account student;     
		 -->

	</main>

	<div th:replace="fragments/scripts :: scripts"></div>

	<footer th:replace="fragments/footer :: footer"></footer>

	<script>

		/*<![CDATA[*/
		var app = new Vue({
			el : '#view-topic',
			data : {
				topic : null
			},
			created : function() {
				var self = this;

				// getting topic
				self.getTopic()
					.then(function(response) {
						self.topic = response.data;
				});
				
			},
			mounted : function() {
				setDisplay('#view-topic', 'block'); // it doesn't show up by default
			},
			methods : {
				getTopic : function() {
					return axios.get(contextPath + 'api/topics/' + this.getTopicId());
				},
				getTopicId: function() {
					let topic = $('#topic')[0].innerHTML;
					return (topic == '' ? -1 : topic);
				},
				getAccountId: function() {
					return $('#account')[0].innerHTML;
				},
				getFileLink: function (attachment) {
	                return contextPath + 'api/files/' + attachment.fileId;
	            },
				formatDate: function(longTime, formatText) {
					return formatDate(longTime, formatText);
				},
				formatBoolean: function(value) {
					return value != null ? (value == true ? 'igen' : 'nem') : '';
				},
				editTopic: function() {
					redirect(contextPath + 'topics/' + this.getTopicId() + '/edit');
				},
				fillFormFromTopic: function() {
					redirect(contextPath + 'forms/' + this.getTopicId());
				}
			}
		});
		/*]]>*/
	</script>

</body>
</html>
